<html>
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
        <title>4.5 Continuous Queries</title>
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen" title="Ref" charset="utf-8"/>
    </head>
    <body class="body">
    Continuous queries are a feature of Gemfire that allows a client to subscribe to cache events using a query.<p class="paragraph"/>To use continuous queries you need to have a <a href="../guide/single.html#3. Cache Servers" class="guide">Cache Server</a> running with <code>subscriptionEnabled</code> set to <code>true</code> (see the configuration in the previous section). Then simply use the <code>cq</code> namespace to execute a dynamic finder that takes a closure:<p class="paragraph"/><div class="code"><pre>Person.cq.findAllByLastName(<span class="java&#45;quote">"Flintstone"</span>) &#123; event &#45;&#62;
			println <span class="java&#45;quote">"GOT EVENT $event"</span>
&#125;</pre></div><p class="paragraph"/>The above will execute a continuous query that fires every time a <code>Person</code> with the surname "Flinstone" is inserted or updated in the cache. The <code>event</code> object is an instance of <a href="http://www.gemstone.com/docs/current/product/docs/japi/com/gemstone/gemfire/cache/query/CqEvent.html" target="blank">CqEvent</a> which contains methods to get the value and the operation that triggered the event.<p class="paragraph"/>Typically you would write an event handler that checks if an exception was thrown:<p class="paragraph"/>
<div class="code"><pre>Person.cq.findAllByLastName(<span class="java&#45;quote">"Flintstone"</span>) &#123; event &#45;&#62;
	<span class="java&#45;keyword">if</span>(!event.throwable) &#123;
		println <span class="java&#45;quote">"NEW FLINSTONE $&#123;event.newValue.firstName&#125;"</span>
	&#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>

    </body>
</html>
